 40)   4000 C3 78 40    		      JP MYOS_CLRSCN	;
 41)   4003 C3 79 40    		      JP MYOS_PUTIME	;
 42)   4006 C3 7A 40    		      JP MYOS_GETIME	;
 43)   4009 C3 81 40    		      JP MYOS_PUTCSR	;
 44)   400C C3 82 40    		      JP MYOS_GETCSR	;
 45)   400F C3 89 40    		      JP MYOS_OSRDCH	;
 46)   4012 C3 8C 40    		      JP MYOS_PROMPT	;
 47)   4015 C3 8E 40    		      JP MYOS_OSWRCH	;
 48)   4018 C3 9C 40    		      JP MYOS_OSKEY	;
 49)   401B C3 CD 40    		      JP MYOS_OSINIT	;
 50)   401E C3 D6 40    		      JP MYOS_OSLINE	;
 51)   4021 C3 EE 40    		      JP MYOS_OSCLI	;
 52)   4024 C3 B0 41    		      JP MYOS_OSBPUT 	;
 53)   4027 C3 B0 41    		      JP MYOS_OSBGET 	;
 54)   402A C3 B0 41    		      JP MYOS_OSSTAT 	;
 55)   402D C3 B0 41    		      JP MYOS_OSSHUT 	;
 56)   4030 C3 B0 41    		      JP MYOS_OSOPEN 	;
 57)   4033 C3 B0 41    		      JP MYOS_OSCALL 	;
 58)   4036 C3 61 41    		      JP MYOS_OSSAVE 	;
 59)   4039 C3 84 41    		      JP MYOS_OSLOAD 	;
 60)   403C C3 B0 41    		      JP MYOS_GETPTR 	;
 61)   403F C3 B0 41    		      JP MYOS_PUTPTR 	;
 62)   4042 C3 B0 41    		      JP MYOS_GETEXT 	;
 63)   4045 C3 B0 41    		      JP MYOS_RESET 	;
 64)   4048 C3 BD 40    		      JP MYOS_TRAP	;
 65)   404B C3 C0 40    		      JP MYOS_LTRAP  	;
 66)   404E C3 B1 41    		      JP MYOS_CLG	;
 67)   4051 C3 B1 41    		      JP MYOS_COLOUR	;
 68)   4054 C3 B1 41    		      JP MYOS_DRAW	;
 69)   4057 C3 B1 41    		      JP MYOS_ENVEL	;
 70)   405A C3 B1 41    		      JP MYOS_GCOL	;
 71)   405D C3 B1 41    		      JP MYOS_MODE	;
 72)   4060 C3 B1 41    		      JP MYOS_MOVE	;
 73)   4063 C3 B1 41    		      JP MYOS_PLOT	;
 74)   4066 C3 B1 41    		      JP MYOS_SOUND	;
 75)   4069 C3 B1 41    		      JP MYOS_ADVAL	;
 76)   406C C3 B1 41    		      JP MYOS_POINT	;
 77)   406F C3 B1 41    		      JP MYOS_GETIMS	;
 78)   4072 C3 B1 41    		      JP MYOS_PUTIMS    	;
 83)   4075 C3 0C 47    		TEST: JP LCD_TEST    	;
 86)   4078 C9          		           RET	;
 88)   4079 C9          				       RET	;
 90)   407A 11 00 00    		       		 LD DE, 0	;
 91)   407D 21 00 00    		 	  		   LD HL, 0	;
 92)   4080 C9          					     RET		       	;
 94)   4081 C9          		           RET	;
 96)   4082 11 00 00    		           LD DE,0	;
 97)   4085 21 00 00    					     LD HL,0	;
 98)   4088 C9          					     RET	;
100)   4089 DB 00       		           IN A,(PORT_STM_IO)	;
101)   408B C9          					     RET			;
103)   408C 3E 3E       		           LD A,'>'			     	;
105)   408E D3 00       		           OUT (0),A  	;
106)   4090 F5          		           PUSH AF	;
107)   4091 C5          		           PUSH BC	;
108)   4092 D5          		           PUSH DE	;
109)   4093 E5          							 PUSH HL	;
110)   4094 CD 53 46    		           CALL LCD_PRINTCHAR	;
111)   4097 E1          		           POP HL	;
112)   4098 D1          		           POP DE	;
113)   4099 C1          		           POP BC	;
114)   409A F1          		           POP AF	;
115)   409B C9          					     RET 	;
124)   409C 2B          		            DEC HL 	;
125)   409D 7C          					      LD A,H	;
126)   409E B5          					      OR L	;
127)   409F C8          					      RET Z 	;
128)   40A0 DB 00       					      IN A,(PORT_STM_IO)	;
129)   40A2 28 F8       					      JR Z,MYOS_OSKEY	;
130)   40A4 FE 1B       					      CP 0x1B			; ESC	; ESC
131)   40A6 37          					      SCF 	;
132)   40A7 C0          					      RET NZ	;
133)   40A8 E5          		ESCSET: 		PUSH    HL	;
134)   40A9 21 00 63    		        		LD      HL,FLAGS	;
135)   40AC CB 76       		        		BIT     6,(HL)          ; ESC DISABLED?	; ESC DISABLED?
136)   40AE 20 02       		        		JR      NZ,ESCDIS	;
137)   40B0 CB FE       		        		SET     7,(HL)          ; SET ESCAPE FLAG	; SET ESCAPE FLAG
138)   40B2 E1          		ESCDIS: 		POP     HL	;
139)   40B3 C9          		        		RET		;
140)   40B4 DB 00       		ESCTEST:		IN A,(PORT_STM_IO)	;
141)   40B6 B7          				      	OR A	;
142)   40B7 C8          				      	RET Z	;
143)   40B8 FE 1B       				      	CP 0x1B			; ESC		; ESC
144)   40BA 28 EC       			      		JR Z,ESCSET	;
145)   40BC C9          			       		RET	;
147)   40BD CD B4 40    		MYOS_TRAP:			CALL ESCTEST	;
148)   40C0 3A 00 63    		MYOS_LTRAP:			LD A,(FLAGS)	;
149)   40C3 B7          					          OR A	;
150)   40C4 F0          				           	RET P	;
151)   40C5 21 00 63    			          		LD HL,FLAGS 	;
152)   40C8 CB BE       				          	RES 7,(HL)	;
153)   40CA C3 E4 0D    				          	JP ESCAPE          	;
161)   40CD AF          		            XOR A	;
162)   40CE 11 FF FF    		         		LD DE,0xFFFF		;DE = HIMEM	;DE = HIMEM
163)   40D1 5F          		         		LD E,A             	;PAGE BOUNDARY	;PAGE BOUNDARY
164)   40D2 21 08 63    		         		LD HL,@USER	;
165)   40D5 C9          		         		RET		;
175)   40D6 CD C1 41    		             CALL READ_CHAR	;
176)   40D9 28 FB       					       JR Z,MYOS_OSLINE	;
177)   40DB B7          					       OR A 	;
178)   40DC 28 F8       					       JR Z,MYOS_OSLINE 	;
179)   40DE 77          					       LD (HL),A	;
180)   40DF 23          					       INC HL	;
181)   40E0 FE 0D       					       CP 0x0D	;
182)   40E2 28 05       					       JR Z,L1 	;
183)   40E4 CD 8E 40    					       CALL MYOS_OSWRCH	;
184)   40E7 18 ED       					       JR MYOS_OSLINE 	;
185)   40E9 CD 8F 08    		L1:    			 CALL @CRLF	;
186)   40EC A7          					       AND A	;
187)   40ED C9          					       RET 	;
193)   40EE CD 48 41    		      CALL    SKIPSP	;
194)   40F1 FE 0D       					CP      CR	;
195)   40F3 C8          					RET     Z	;
196)   40F4 FE 7C       					CP      '|'	;
197)   40F6 C8          					RET     Z	;
198)   40F7 FE 2E       					CP      '.'	;
199)   40F9 CA 57 41    					JP      Z,DOT           ;*.	;*.
200)   40FC EB          					EX      DE,HL	;
201)   40FD 21 5B 41    					LD      HL,COMDS	;
202)   4100 1A          		OSCLI0:			LD      A,(DE)	;
203)   4101 CD 4F 41    					CALL    UPPRC	;
204)   4104 BE          					CP      (HL)	;
205)   4105 28 0B       					JR      Z,OSCLI2	;
206)   4107 38 2E       					JR      C,HUH	;
207)   4109 CB 7E       		OSCLI1:			BIT     7,(HL)	;
208)   410B 23          					INC     HL	;
209)   410C 28 FB       					JR      Z,OSCLI1	;
210)   410E 23          					INC     HL	;
211)   410F 23          					INC     HL	;
212)   4110 18 EE       					JR      OSCLI0	;
214)   4112 D5          		OSCLI2:			PUSH    DE	;
215)   4113 13          		OSCLI3:			INC     DE	;
216)   4114 23          					INC     HL	;
217)   4115 1A          					LD      A,(DE)	;
218)   4116 CD 4F 41    					CALL    UPPRC	;
219)   4119 FE 2E       					CP      '.'             ;ABBREVIATED?	;ABBREVIATED?
220)   411B 28 0A       					JR      Z,OSCLI4	;
221)   411D AE          					XOR     (HL)	;
222)   411E 28 F3       					JR      Z,OSCLI3	;
223)   4120 FE 80       					CP      80H	;
224)   4122 28 03       					JR      Z,OSCLI4	;
225)   4124 D1          					POP     DE	;
226)   4125 18 E2       					JR      OSCLI1	;
228)   4127 F1          		OSCLI4:			POP     AF	;
229)   4128 13          				        INC     DE	;
230)   4129 CB 7E       		OSCLI5:			BIT     7,(HL)	;
231)   412B 23          					INC     HL	;
232)   412C 28 FB       					JR      Z,OSCLI5	;
233)   412E 7E          					LD      A,(HL)	;
234)   412F 23          					INC     HL	;
235)   4130 66          					LD      H,(HL)	;
236)   4131 6F          					LD      L,A	;
237)   4132 E5          					PUSH    HL	;
238)   4133 EB          					EX      DE,HL	;
239)   4134 C3 48 41    					JP      SKIPSP	;
241)   4137 3E FE       		HUH:    		LD      A,254	;
242)   4139 CD 12 07    		        		CALL    EXTERR	;
243)   413C 42 61 64 20 		        		DEFM    'Bad command'	;
243)   4140 63 6F 6D 6D 		        		DEFM    'Bad command'	;
243)   4144 61 6E 64    		        		DEFM    'Bad command'	;
244)   4147 00          		        		DEFB    0				;
246)   4148 7E          		SKIPSP:			LD      A,(HL)	;
247)   4149 FE 20       		        		CP      ' '	;
248)   414B C0          		        		RET     NZ	;
249)   414C 23          		        		INC     HL	;
250)   414D 18 F9       		        		JR      SKIPSP		;
252)   414F E6 7F       		UPPRC:  		AND     7FH	;
253)   4151 FE 60       					CP      '`'	;
254)   4153 D8          					RET     C	;
255)   4154 E6 5F       					AND     5FH             ;CONVERT TO UPPER CASE	;CONVERT TO UPPER CASE
256)   4156 C9          					RET						;
259)   4157 C9          		DOT:			RET	;
263)   4158 C3 00 00    		BYE:			JP 0	;
265)   415B 42 59       		COMDS:  		DEFM    'BY'	;
266)   415D C5          					DEFB    'E'+80H	;
267)   415E 58 41       					DEFW    BYE	;
268)   4160 FF          					DEFB	0FFH	;
279)   4161 3E DD       		            LD A,0xDD	;
280)   4163 D3 20       		            OUT (PORT_TAPE),A	;
281)   4165 3E 0A       		            LD A,COMMD_SAVE	;
282)   4167 D3 20       		            OUT (PORT_TAPE),A	;
284)   4169 7E          		OSSV_NXT:   LD A,(HL)	;
285)   416A D3 20       		            OUT (PORT_TAPE),A	;
286)   416C 23          		            INC HL	;
287)   416D FE 0D       		            CP 0x0D	;
288)   416F 20 F8       		            JR NZ,OSSV_NXT	;
290)   4171 79          		            LD A,C	;
291)   4172 D3 20       		            OUT (PORT_TAPE),A	;
292)   4174 78          		            LD A,B	;
293)   4175 D3 20       		            OUT (PORT_TAPE),A	;
295)   4177 2A DC 62    		            LD HL,(PAGE)	;
296)   417A 7E          		OSSV_NXT2:  LD A,(HL)	;
297)   417B D3 20       		            OUT (PORT_TAPE),A	;
298)   417D 23          		            INC HL	;
299)   417E 0B          		            DEC BC	;
300)   417F 78          		            LD A,B	;
301)   4180 B1          		            OR C	;
302)   4181 20 F7       		            JR NZ,OSSV_NXT2                        	;
303)   4183 C9          		            RET              	;
309)   4184 3E DD       		            LD A,0xDD	;
310)   4186 D3 20       		            OUT (PORT_TAPE),A	;
311)   4188 3E 14       		            LD A,COMMD_LOAD	;
312)   418A D3 20       		            OUT (PORT_TAPE),A	;
314)   418C 7E          		OSLD_NXT:   LD A,(HL)	;
315)   418D D3 20       		            OUT (PORT_TAPE),A	;
316)   418F 23          		            INC HL	;
317)   4190 FE 0D       		            CP 0x0D	;
318)   4192 20 F8       		            JR NZ,OSLD_NXT	;
320)   4194 DB 20       		            IN A,(PORT_TAPE)	;
321)   4196 4F          		            LD C,A	;
322)   4197 DB 20       		            IN A,(PORT_TAPE)	;
323)   4199 47          		            LD B,A	;
325)   419A 2A DC 62    		            LD HL,(PAGE)                        	;
326)   419D DB 20       		OSLD_NXT2:  IN A,(PORT_TAPE)	;
327)   419F 77          		            LD (HL),A	;
328)   41A0 23          		            INC HL	;
329)   41A1 0B          		            DEC BC	;
330)   41A2 78          		            LD A,B	;
331)   41A3 B1          		            OR C	;
332)   41A4 20 F7       		            JR NZ,OSLD_NXT2                        	;
333)   41A6 44          		            LD B,H	;
334)   41A7 4D          		            LD C,L	;
335)   41A8 21 DE 62    		            LD HL,TOP ;SAVE TOP OF BASIC 	;SAVE TOP OF BASIC
336)   41AB 70          		            LD (HL),B	;
337)   41AC 23          		            INC HL	;
338)   41AD 71          		            LD (HL),C            	;
339)   41AE B7          		            OR A        ;CLEAR C = NO ERROR            	;CLEAR C = NO ERROR
340)   41AF C9          		            RET   	;
354)   41B0 C9          		            RET	;
369)   41B1 AF          					XOR     A	;
370)   41B2 CD 12 07    					CALL    EXTERR	;
371)   41B5 53 6F 72 72 					DEFM    'Sorry'	;
371)   41B9 79          					DEFM    'Sorry'	;
372)   41BA 00          					DEFB    0            	;
378)   41BB D3 00       		Print_Char:		OUT (PORT_STM_IO),A 	;
379)   41BD CD 53 46    						CALL LCD_PRINTCHAR	;
380)   41C0 C9          					RET 	;
385)   41C1 DB 07       		Read_Char:		IN A,(PORT_STM_FLAGS)	;
386)   41C3 E6 01       					AND 0x01	;
387)   41C5 28 FA       					JR Z,Read_Char	;
388)   41C7 DB 00       		Read_Char_NB:		IN A,(PORT_STM_IO)	;
389)   41C9 C9          					RET       	;
398)   41CA CB 21       		      SLA C	;
399)   41CC CB 21       		      SLA C	;
400)   41CE CB 21       		      SLA C	;
401)   41D0 41          		      LD B,C	;
402)   41D1 10 FE       		DEL0: DJNZ DEL0	;
403)   41D3 C9          		      RET   	;
408)   41D4 7B          		    LD A,E	;
409)   41D5 D3 05       		    OUT (LCD_CS),A	;
414)   41D7 7A          		    LD A,D  	;
415)   41D8 D3 05       		    OUT (LCD_CS),A	;
416)   41DA C9          		    RET	;
421)   41DB AF          		    XOR A	;
422)   41DC D3 04       		    OUT (LCD_RS),A  ;RS LOW = COMMAND BYTE      	;RS LOW = COMMAND BYTE
423)   41DE CD D7 41    		    CALL LCD_WR_BUS	;
424)   41E1 3E 01       		    LD A,1	;
425)   41E3 D3 04       		    OUT (LCD_RS),A  ;RS HIGH  = DATA BYTE	;RS HIGH  = DATA BYTE
426)   41E5 C9          		    RET	;
430)   41E6 16 E2       		    LD D,0xE2         ;PLL multiplier, set PLL clock to 120M	;PLL multiplier, set PLL clock to 120M
431)   41E8 CD DB 41    		    CALL LCD_WR_COM   ;N=0x36 for 6.5M, 0x23 for 10M crystal	;N=0x36 for 6.5M, 0x23 for 10M crystal
432)   41EB 16 1E       		    LD D,0x1E	;
433)   41ED CD D7 41    		    CALL LCD_WR_DAT	;
434)   41F0 16 02       		    LD D,0x02	;
435)   41F2 CD D7 41    		    CALL LCD_WR_DAT	;
436)   41F5 16 54       		    LD D,0x54	;
437)   41F7 CD D7 41    		    CALL LCD_WR_DAT	;
438)   41FA 16 E0       		    LD D,0xE0         ; PLL enable    	; PLL enable
439)   41FC CD DB 41    		    CALL LCD_WR_COM	;
440)   41FF 16 01       		    LD D,0x01	;
441)   4201 CD D7 41    		    CALL LCD_WR_DAT	;
442)   4204 01 0A 00    		    LD BC,10        ;delay(10);	;delay(10);
443)   4207 CD CA 41    		    CALL DELAY	;
444)   420A 16 E0       		    LD D,0xE0         ; PLL enable    	; PLL enable
445)   420C CD DB 41    		    CALL LCD_WR_COM   	;
446)   420F 16 03       		    LD D,0x03	;
447)   4211 CD D7 41    		    CALL LCD_WR_DAT	;
448)   4214 01 0A 00    		    LD BC,10        ;delay(10);	;delay(10);
449)   4217 CD CA 41    		    CALL DELAY    	;
451)   421A 16 01       		    LD D,0x01         ; software reset  	; software reset
452)   421C CD DB 41    		    CALL LCD_WR_COM   	;
453)   421F 01 64 00    		    LD BC,100       ;delay(100);	;delay(100);
454)   4222 CD CA 41    		    CALL DELAY        	;
455)   4225 16 E6       		    LD D,0xE6         ;PLL setting for PCLK, depends on resolution  	;PLL setting for PCLK, depends on resolution
456)   4227 CD DB 41    		    CALL LCD_WR_COM           	;
457)   422A 16 03       		    LD D,0x03	;
458)   422C CD D7 41    		    CALL LCD_WR_DAT   	;
459)   422F 16 FF       		    LD D,0xFF	;
460)   4231 CD D7 41    		    CALL LCD_WR_DAT       	;
461)   4234 16 FF       		    LD D,0xFF	;
462)   4236 CD D7 41    		    CALL LCD_WR_DAT   	;
464)   4239 16 E6       		    LD D,0xE6         ;LCD SPECIFICATION	;LCD SPECIFICATION
465)   423B CD DB 41    		    CALL LCD_WR_COM       	;
466)   423E 16 20       		    LD D,0x20	;
467)   4240 CD D7 41    		    CALL LCD_WR_DAT   	;
468)   4243 16 00       		    LD D,0x00	;
469)   4245 CD D7 41    		    CALL LCD_WR_DAT       	;
470)   4248 16 03       		    LD D,0x03         ;Set HDP  799	;Set HDP  799
471)   424A CD D7 41    		    CALL LCD_WR_DAT   	;
472)   424D 16 1F       		    LD D,0x1F	;
473)   424F CD D7 41    		    CALL LCD_WR_DAT   	;
474)   4252 16 01       		    LD D,0x01         ;Set VDP  479	;Set VDP  479
475)   4254 CD D7 41    		    CALL LCD_WR_DAT   	;
476)   4257 16 DF       		    LD D,0xDF	;
477)   4259 CD D7 41    		    CALL LCD_WR_DAT 	;
478)   425C 16 00       		    LD D,0x00	;
479)   425E CD D7 41    		    CALL LCD_WR_DAT     	;
482)   4261 16 B4       		    LD D,0xB4         ;HSYNC	;HSYNC
483)   4263 CD DB 41    		    CALL LCD_WR_COM       	;
484)   4266 16 03       		    LD D,0x03         ;Set HT 928	;Set HT 928
485)   4268 CD D7 41    		    CALL LCD_WR_DAT   	;
486)   426B 16 A0       		    LD D,0xA0	;
487)   426D CD D7 41    		    CALL LCD_WR_DAT       	;
488)   4270 16 00       		    LD D,0x00         ;Set HPS  46	;Set HPS  46
489)   4272 CD D7 41    		    CALL LCD_WR_DAT   	;
490)   4275 16 2E       		    LD D,0x2E	;
491)   4277 CD D7 41    		    CALL LCD_WR_DAT   	;
492)   427A 16 30       		    LD D,0x30         ;Set HPW  48	;Set HPW  48
493)   427C CD D7 41    		    CALL LCD_WR_DAT   	;
494)   427F 16 00       		    LD D,0x00         ;Set LPS  15	;Set LPS  15
495)   4281 CD D7 41    		    CALL LCD_WR_DAT 	;
496)   4284 16 0F       		    LD D,0x0F	;
497)   4286 CD D7 41    		    CALL LCD_WR_DAT   	;
498)   4289 16 00       		    LD D,0x00	;
499)   428B CD D7 41    		    CALL LCD_WR_DAT     	;
501)   428E 16 B6       		    LD D,0xB6         ;VSYNC	;VSYNC
502)   4290 CD DB 41    		    CALL LCD_WR_COM       	;
503)   4293 16 02       		    LD D,0x02         ;Set VT 525	;Set VT 525
504)   4295 CD D7 41    		    CALL LCD_WR_DAT   	;
505)   4298 16 0D       		    LD D,0x0D	;
506)   429A CD D7 41    		    CALL LCD_WR_DAT       	;
507)   429D 16 00       		    LD D,0x00         ;Set VPS  16	;Set VPS  16
508)   429F CD D7 41    		    CALL LCD_WR_DAT   	;
509)   42A2 16 10       		    LD D,0x10	;
510)   42A4 CD D7 41    		    CALL LCD_WR_DAT   	;
511)   42A7 16 10       		    LD D,0x10         ;Set VPW  16	;Set VPW  16
512)   42A9 CD D7 41    		    CALL LCD_WR_DAT   	;
513)   42AC 16 00       		    LD D,0x00         ;Set FPS  8	;Set FPS  8
514)   42AE CD D7 41    		    CALL LCD_WR_DAT 	;
515)   42B1 16 08       		    LD D,0x08	;
516)   42B3 CD D7 41    		    CALL LCD_WR_DAT   	;
518)   42B6 16 BA       		    LD D,0xBA         	;
519)   42B8 CD DB 41    		    CALL LCD_WR_COM           	;
520)   42BB 16 0F       		    LD D,0x0F	;
521)   42BD CD D7 41    		    CALL LCD_WR_DAT   ;GPIO[3:0] out 1	;GPIO[3:0] out 1
523)   42C0 16 B8       		    LD D,0xB8         	;
524)   42C2 CD DB 41    		    CALL LCD_WR_COM           	;
525)   42C5 16 07       		    LD D,0x07         ;GPIO3=input, GPIO[2:0]=output	;GPIO3=input, GPIO[2:0]=output
526)   42C7 CD D7 41    		    CALL LCD_WR_DAT         	;
527)   42CA 16 01       		    LD D,0x01         ;GPIO0 normal	;GPIO0 normal
528)   42CC CD D7 41    		    CALL LCD_WR_DAT             	;
530)   42CF 16 36       		    LD D,0x36         ;rotation	;rotation
531)   42D1 CD DB 41    		    CALL LCD_WR_COM           	;
532)   42D4 16 2A       		    LD D,0x2A         	;
533)   42D6 CD D7 41    		    CALL LCD_WR_DAT         	;
535)   42D9 16 F0       		    LD D,0xF0         ;pixel data interface	;pixel data interface
536)   42DB CD DB 41    		    CALL LCD_WR_COM           	;
537)   42DE 16 03       		    LD D,0x03         ;CHANGE THIS FOR 8 BIT INTERFACE  	;CHANGE THIS FOR 8 BIT INTERFACE
538)   42E0 CD D7 41    		    CALL LCD_WR_DAT     	;
540)   42E3 01 01 00    		    LD BC,1       ;delay(1);	;delay(1);
541)   42E6 CD CA 41    		    CALL DELAY        	;
543)   42E9 16 B8       		    LD D,0xB8         ;pixel data interface	;pixel data interface
544)   42EB CD DB 41    		    CALL LCD_WR_COM           	;
545)   42EE 16 0F       		    LD D,0x0F         ;GPIO is controlled by host GPIO[3:0]=output   GPIO[0]=1  LCD ON  GPIO[0]=1  LCD OFF	;GPIO is controlled by host GPIO[3:0]=output   GPIO[0]=1  LCD ON  GPIO[0]=1  LCD OFF
546)   42F0 CD D7 41    		    CALL LCD_WR_DAT   	;
547)   42F3 16 01       		    LD D,0x01         ;GPIO0 normal	;GPIO0 normal
548)   42F5 CD D7 41    		    CALL LCD_WR_DAT   	;
550)   42F8 16 BA       		    LD D,0xBA         	;
551)   42FA CD DB 41    		    CALL LCD_WR_COM           	;
552)   42FD 16 01       		    LD D,0x01         ;GPIO[0] out 1 --- LCD display on/off control PIN	;GPIO[0] out 1 --- LCD display on/off control PIN
553)   42FF CD D7 41    		    CALL LCD_WR_DAT   	;
555)   4302 21 00 00    		    LD HL,0	;
556)   4305 E5          		    PUSH HL	;
557)   4306 E5          		    PUSH HL	;
558)   4307 21 1F 03    		    LD HL,799	;
559)   430A E5          		    PUSH HL	;
560)   430B 21 DF 01    		    LD HL,479	;
561)   430E E5          		    PUSH HL	;
562)   430F CD 4A 43    		    CALL LCD_SETXY	;
563)   4312 21 08 00    		    LD HL,8       ;REMOVE 4 PARAMS FROM STACK	;REMOVE 4 PARAMS FROM STACK
564)   4315 39          		    ADD HL,SP	;
565)   4316 F9          		    LD SP,HL	;
567)   4317 16 29       		    LD D,0x29         ;display on 	;display on
568)   4319 CD DB 41    		    CALL LCD_WR_COM       	;
569)   431C 16 BE       		    LD D,0xBE         ;set PWM for B/L	;set PWM for B/L
570)   431E CD DB 41    		    CALL LCD_WR_COM                 	;
571)   4321 16 F0       		    LD D,0xF0         	;
572)   4323 CD D7 41    		    CALL LCD_WR_DAT   	;
573)   4326 16 01       		    LD D,0x01         	;
574)   4328 CD D7 41    		    CALL LCD_WR_DAT   	;
575)   432B 16 F0       		    LD D,0xF0         	;
576)   432D CD D7 41    		    CALL LCD_WR_DAT   	;
577)   4330 16 00       		    LD D,0x00         	;
578)   4332 CD D7 41    		    CALL LCD_WR_DAT   	;
579)   4335 16 00       		    LD D,0x00         	;
580)   4337 CD D7 41    		    CALL LCD_WR_DAT                   	;
582)   433A 16 D0       		    LD D,0xD0         	;
583)   433C CD DB 41    		    CALL LCD_WR_COM                 	;
584)   433F 16 0D       		    LD D,0x0D         	;
585)   4341 CD D7 41    		    CALL LCD_WR_DAT         	;
587)   4344 16 2C       		    LD D,0x2C       	;
588)   4346 CD DB 41    		    CALL LCD_WR_COM 	;
589)   4349 C9          		    RET	;
606)   434A DD 21 02 00 		    LD IX,2	;
607)   434E DD 39       		    ADD IX,SP         	;
608)   4350 16 2A       		    LD D,0x2A         ;SEND IX PARAMS	;SEND IX PARAMS
609)   4352 CD DB 41    		    CALL LCD_WR_COM    	;
610)   4355 DD 56 07    		    LD D,(IX+7)	;
611)   4358 CD D7 41    		    CALL LCD_WR_DAT	;
612)   435B DD 56 06    		    LD D,(IX+6)	;
613)   435E CD D7 41    		    CALL LCD_WR_DAT	;
614)   4361 DD 56 03    		    LD D,(IX+3)	;
615)   4364 CD D7 41    		    CALL LCD_WR_DAT	;
616)   4367 DD 56 02    		    LD D,(IX+2)	;
617)   436A CD D7 41    		    CALL LCD_WR_DAT       	;
618)   436D 16 2B       		    LD D,0x2B         ;SEND Y PARAMS	;SEND Y PARAMS
619)   436F CD DB 41    		    CALL LCD_WR_COM   	;
620)   4372 DD 56 05    		    LD D,(IX+5)	;
621)   4375 CD D7 41    		    CALL LCD_WR_DAT	;
622)   4378 DD 56 04    		    LD D,(IX+4)	;
623)   437B CD D7 41    		    CALL LCD_WR_DAT	;
624)   437E DD 56 01    		    LD D,(IX+1)	;
625)   4381 CD D7 41    		    CALL LCD_WR_DAT	;
626)   4384 DD 56 00    		    LD D,(IX)	;
627)   4387 CD D7 41    		    CALL LCD_WR_DAT       	;
628)   438A 16 2C       		    LD D,0x2C         ;SEND DATA	;SEND DATA
629)   438C CD DB 41    		    CALL LCD_WR_COM           	;
630)   438F C9          		    RET	;
635)   4390 54          		    LD D,H        	;
636)   4391 CD D7 41    		    CALL LCD_WR_DAT 	;
637)   4394 55          		    LD D,L	;
638)   4395 CD D7 41    		    CALL LCD_WR_DAT 	;
639)   4398 C9          		    RET	;
642)   4399 DD 21 02 00 		    LD IX,2     ;setXY(x, y, x, y);	;setXY(x, y, x, y);
643)   439D DD 39       		    ADD IX,SP	;
644)   439F DD 66 03    		    LD H,(IX+3)   ;X	;X
645)   43A2 DD 6E 02    		    LD L,(IX+2)   ;X	;X
646)   43A5 DD 56 01    		    LD D,(IX+1) ;Y	;Y
647)   43A8 DD 5E 00    		    LD E,(IX) ;Y	;Y
648)   43AB E5          		    PUSH HL	;
649)   43AC D5          		    PUSH DE	;
650)   43AD E5          		    PUSH HL	;
651)   43AE D5          		    PUSH DE	;
652)   43AF CD 4A 43    		    CALL LCD_SETXY	;
653)   43B2 21 08 00    		    LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
654)   43B5 39          		    ADD HL,SP	;
655)   43B6 F9          		    LD SP,HL	;
656)   43B7 2A 01 63    		    LD HL,(FCOLOR)	;
657)   43BA CD 90 43    		    CALL LCD_SETPIXEL	;
658)   43BD CD C1 43    		    CALL LCD_CLRXY	;
659)   43C0 C9          		    RET	;
662)   43C1 21 00 00    		     LD HL,0	;
663)   43C4 E5          		     PUSH HL	;
664)   43C5 E5          		     PUSH HL	;
665)   43C6 21 1F 03    		     LD HL,LCD_WIDTH	;
666)   43C9 E5          		     PUSH HL	;
667)   43CA 21 DF 01    		     LD HL,LCD_HEIGHT	;
668)   43CD E5          		     PUSH HL	;
669)   43CE CD 4A 43    		     CALL LCD_SETXY	;
670)   43D1 21 08 00    		     LD HL,8        ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
671)   43D4 39          		     ADD HL,SP	;
672)   43D5 F9          		     LD SP,HL	;
673)   43D6 C9          		     RET	;
677)   43D7 DD 21 02 00 		      LD IX,2	;
678)   43DB DD 39       		      ADD IX,SP	;
679)   43DD DD 66 05    		      LD H,(IX+5)   ;X  	;X
680)   43E0 DD 6E 04    		      LD L,(IX+4)   ;X	;X
681)   43E3 DD 56 03    		      LD D,(IX+3)   ;Y	;Y
682)   43E6 DD 5E 02    		      LD E,(IX+2)   ;Y	;Y
683)   43E9 DD 46 01    		      LD B,(IX+1)   ;LENGTH	;LENGTH
684)   43EC DD 4E 00    		      LD C,(IX)     ;LENGTH	;LENGTH
687)   43EF E5          		      PUSH HL	;
688)   43F0 21 00 00    		      LD HL,0	;
689)   43F3 B7          		      OR A           ;CLEAR CARRY	;CLEAR CARRY
690)   43F4 ED 42       		      SBC HL,BC      ;CHECK IF LENGTH<0	;CHECK IF LENGTH<0
691)   43F6 38 0A       		      JR C,POSH1	;
692)   43F8 AF          		      XOR A          ;l=-l	;l=-l
693)   43F9 91          					SUB C	;
694)   43FA 4F          					LD C,A	;
695)   43FB 9F          					SBC A,A	;
696)   43FC 90          					SUB B	;
697)   43FD 47          					LD B,A	;
698)   43FE E1          					POP HL	;
699)   43FF ED 42       		      SBC HL,BC       ;x -= l;	;x -= l;
700)   4401 E5          		      PUSH HL                    	;
701)   4402 E1          		POSH1: POP HL	;
702)   4403 E5          					PUSH HL	;
703)   4404 D5          		      PUSH DE	;
704)   4405 09          		      ADD HL,BC	;
705)   4406 E5          		      PUSH HL	;
706)   4407 D5          		      PUSH DE	;
707)   4408 CD 4A 43    		      CALL LCD_SETXY   ;setXY(x, y, x+l, y);	;setXY(x, y, x+l, y);
708)   440B 21 08 00    		      LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
709)   440E 39          		      ADD HL,SP	;
710)   440F F9          		      LD SP,HL	;
711)   4410 2A 01 63    		      LD HL,(FCOLOR)    	;
712)   4413 CD 90 43    		NXTH1: CALL LCD_SETPIXEL	;
713)   4416 0B          		      DEC BC	;
714)   4417 79          		      LD A,C	;
715)   4418 B0          		      OR B	;
716)   4419 20 F8       		      JR NZ, NXTH1     	;
717)   441B CD C1 43    		      CALL LCD_CLRXY	;
718)   441E C9          		      RET	;
723)   441F DD 21 02 00 		      LD IX,2	;
724)   4423 DD 39       		      ADD IX,SP	;
725)   4425 DD 56 05    		      LD D,(IX+5)   ;X  	;X
726)   4428 DD 5E 04    		      LD E,(IX+4)   ;X	;X
727)   442B DD 66 03    		      LD H,(IX+3)   ;Y	;Y
728)   442E DD 6E 02    		      LD L,(IX+2)   ;Y	;Y
729)   4431 DD 46 01    		      LD B,(IX+1)   ;LENGTH	;LENGTH
730)   4434 DD 4E 00    		      LD C,(IX)     ;LENGTH     	;LENGTH
731)   4437 E5          		      PUSH HL	;
732)   4438 21 00 00    		      LD HL,0	;
733)   443B B7          		      OR A           ;CLEAR CARRY	;CLEAR CARRY
734)   443C ED 42       		      SBC HL,BC      ;CHECK IF LENGTH<0	;CHECK IF LENGTH<0
735)   443E 38 0A       		      JR C,POSV1	;
736)   4440 AF          		      XOR A          ;l=-l	;l=-l
737)   4441 91          					SUB C	;
738)   4442 4F          					LD C,A	;
739)   4443 9F          					SBC A,A	;
740)   4444 90          					SUB B	;
741)   4445 47          					LD B,A	;
742)   4446 E1          					POP HL	;
743)   4447 ED 42       		      SBC HL,BC       ;Y -= l;	;Y -= l;
744)   4449 E5          		      PUSH HL                   	;
745)   444A E1          		POSV1: POP HL	;
746)   444B D5          					PUSH DE	;
747)   444C E5          		      PUSH HL	;
748)   444D D5          		      PUSH DE	;
749)   444E 09          		      ADD HL,BC	;
750)   444F E5          		      PUSH HL	;
751)   4450 CD 4A 43    		      CALL LCD_SETXY   ;setXY(x, y, x, y+l);	;setXY(x, y, x, y+l);
752)   4453 21 08 00    		      LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
753)   4456 39          		      ADD HL,SP	;
754)   4457 F9          		      LD SP,HL	;
755)   4458 2A 01 63    		      LD HL,(FCOLOR)    	;
756)   445B CD 90 43    		NXTV1: CALL LCD_SETPIXEL	;
757)   445E 0B          		      DEC BC	;
758)   445F 79          		      LD A,C	;
759)   4460 B0          		      OR B	;
760)   4461 20 F8       		      JR NZ, NXTV1     	;
761)   4463 CD C1 43    		      CALL LCD_CLRXY	;
762)   4466 C9          		      RET	;
766)   4467 DD 21 02 00 		      LD IX,2	;
767)   446B DD 39       		      ADD IX,SP	;
777)   446D DD 66 05    		      LD H,(IX+5)   ;Y1	;Y1
778)   4470 DD 6E 04    		      LD L,(IX+4)   ;Y1	;Y1
779)   4473 DD 56 01    		      LD D,(IX+1)   ;Y2	;Y2
780)   4476 DD 5E 00    		      LD E,(IX)     ;Y2	;Y2
781)   4479 B7          		      OR A	;
782)   447A ED 52       		      SBC HL,DE	;
783)   447C 20 1A       		      JR NZ,YNOTEQ	;
785)   447E DD 46 07    		      LD B,(IX+7)   ;X1	;X1
786)   4481 DD 4E 06    		      LD C,(IX+6)   ;X1	;X1
787)   4484 C5          		      PUSH BC       ;X1 1ST PARAM ON STACK	;X1 1ST PARAM ON STACK
788)   4485 D5          		      PUSH DE				;Y 2ND PARAM ON STACK	;Y 2ND PARAM ON STACK
789)   4486 DD 66 03    		      LD H,(IX+3)   ;X2	;X2
790)   4489 DD 6E 02    		      LD L,(IX+2)   ;X2       	;X2
791)   448C ED 42       		      SBC HL,BC  	  ;X2-X1 = LENGTH OF HORIZ LINE	;X2-X1 = LENGTH OF HORIZ LINE
792)   448E E5          		      PUSH HL       ;LENGTH 3RD PARAM ON STACK 	;LENGTH 3RD PARAM ON STACK
793)   448F CD D7 43    		      CALL LCD_DRAWHLINE	;
794)   4492 21 06 00    		      LD HL,6       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
795)   4495 39          		      ADD HL,SP	;
796)   4496 F9          		      LD SP,HL      	;
797)   4497 C9          		      RET	;
799)   4498 DD 66 07    		      LD H,(IX+7)   ;X1	;X1
800)   449B DD 6E 06    		      LD L,(IX+6)   ;X1	;X1
801)   449E DD 56 03    		      LD D,(IX+3)   ;X2	;X2
802)   44A1 DD 5E 02    		      LD E,(IX+2)   ;X2 	;X2
803)   44A4 B7          		      OR A	;
804)   44A5 ED 52       		      SBC HL,DE	;
805)   44A7 20 1A       		      JR NZ,XNOTEQ	;
807)   44A9 D5          		      PUSH DE       ;X2=X1 1ST PARAM ON STACK	;X2=X1 1ST PARAM ON STACK
808)   44AA DD 46 05    		      LD B,(IX+5)   ;Y1	;Y1
809)   44AD DD 4E 04    		      LD C,(IX+4)   ;Y1	;Y1
810)   44B0 C5          		      PUSH BC       ;Y1 2ND PARAM ON STACK	;Y1 2ND PARAM ON STACK
811)   44B1 DD 66 01    		      LD H,(IX+1)   ;Y2	;Y2
812)   44B4 DD 6E 00    		      LD L,(IX)   ;Y2       	;Y2
813)   44B7 ED 42       		      SBC HL,BC  	  ;Y2-Y1 = LENGTH OF VERT LINE	;Y2-Y1 = LENGTH OF VERT LINE
814)   44B9 E5          		      PUSH HL       ;LENGTH 3RD PARAM ON STACK 	;LENGTH 3RD PARAM ON STACK
815)   44BA CD 1F 44    		      CALL LCD_DRAWVLINE	;
816)   44BD 21 06 00    		      LD HL,6       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
817)   44C0 39          		      ADD HL,SP	;
818)   44C1 F9          		      LD SP,HL	;
819)   44C2 C9          		      RET	;
822)   44C3 38 04       		      JR C,X2GTX1	;
824)   44C5 AF          		      XOR A			;
825)   44C6 3D          		      DEC A  ;XSTEP=-1	;XSTEP=-1
826)   44C7 18 0D       		      JR DLNXT1	;
829)   44C9 D5          		      PUSH DE	;
830)   44CA E1          		      POP HL	;
831)   44CB DD 56 07    		      LD D,(IX+7)   ;X1	;X1
832)   44CE DD 5E 06    		      LD E,(IX+6)   ;X1 	;X1
833)   44D1 B7          		      OR A     	;
834)   44D2 ED 52       		      SBC HL,DE     ;X2-X1 ON HL	;X2-X1 ON HL
836)   44D4 3E 01       		      LD A,1        ;XSTEP=1	;XSTEP=1
838)   44D6 06 00       		      LD B,0	;
839)   44D8 0E 00       		      LD C,0	;
840)   44DA C5          		      PUSH BC       ;T	;T
841)   44DB E5          		      PUSH HL       ;DX	;DX
842)   44DC FE 01       		      CP 1	;
843)   44DE 28 02       		      JR Z,DLXMINUS1	;
844)   44E0 06 FF       		      LD B,0XFF	;
845)   44E2 4F          		DLXMINUS1:LD C,A      	;
846)   44E3 C5          		      PUSH BC       ;XSTEP	;XSTEP
847)   44E4 DD 66 05    		      LD H,(IX+5)   ;Y1	;Y1
848)   44E7 DD 6E 04    		      LD L,(IX+4)   ;Y1	;Y1
849)   44EA DD 56 01    		      LD D,(IX+1)   ;Y2	;Y2
850)   44ED DD 5E 00    		      LD E,(IX)     ;Y2      	;Y2
851)   44F0 B7          		      OR A	;
852)   44F1 ED 52       		      SBC HL,DE	;
853)   44F3 38 04       		      JR C,Y2GTY1	;
855)   44F5 AF          		      XOR A	;
856)   44F6 3D          		      DEC A         ;YSTEP=-1	;YSTEP=-1
857)   44F7 18 0F       		      JR DLNXT2	;
860)   44F9 D5          		      PUSH DE	;
861)   44FA E1          		      POP HL	;
862)   44FB DD 56 05    		      LD D,(IX+5)   ;Y1	;Y1
863)   44FE DD 5E 04    		      LD E,(IX+4)   ;Y1  	;Y1
864)   4501 B7          		      OR A	;
865)   4502 ED 52       		      SBC HL,DE  	;
867)   4504 06 00       		      LD B,0	;
868)   4506 3E 01       		      LD A,1        ;YSTEP=1	;YSTEP=1
870)   4508 FE 01       		      CP 1	;
871)   450A 28 02       		      JR Z,DLYMINUS1	;
872)   450C 06 FF       		      LD B,0XFF	;
874)   450E 4F          		      LD C,A      	;
875)   450F E5          		      PUSH HL       ;DY	;DY
876)   4510 C5          		      PUSH BC       ;YSTEP   	;YSTEP
877)   4511 FD 21 00 00 		      LD IY,0	;
878)   4515 FD 39       		      ADD IY,SP	;
893)   4517 FD 56 07    		      LD D,(IY+7)    ;DX	;DX
894)   451A FD 5E 06    		      LD E,(IY+6)    ;DX	;DX
895)   451D B7          		      OR A	;
896)   451E ED 52       		      SBC HL,DE      ;DY-DX	;DY-DX
897)   4520 DA BA 45    		      JP C,DXGTDY	;
898)   4523 CA BA 45    		      JP Z,DXGTDY	;
900)   4526 19          		      ADD HL,DE      ;HL=DY	;HL=DY
901)   4527 44          		      LD B,H	;
902)   4528 4D          		      LD C,L	;
903)   4529 CB 38       		      SRL B	;
904)   452B CB 19       		      RR C           ;(dy >> 1)	;(dy >> 1)
905)   452D 21 00 00    		      LD HL,0	;
906)   4530 ED 42       		      SBC HL,BC      ;t = - (dy >> 1);	;t = - (dy >> 1);
907)   4532 FD 74 09    		      LD (IY+9),H    ;SAVE T	;SAVE T
908)   4535 FD 75 08    		      LD (IY+8),L    ;SAVE T	;SAVE T
910)   4538 DD 56 05    		      LD D,(IX+5)   ;ROW	;ROW
911)   453B DD 5E 04    		      LD E,(IX+4)   ;ROW=Y1	;ROW=Y1
912)   453E DD 66 07    		      LD H,(IX+7)   ;COL	;COL
913)   4541 DD 6E 06    		      LD L,(IX+6)   ;COL=X1	;COL=X1
914)   4544 D5          		      PUSH DE	;
915)   4545 DD E5       		      PUSH IX	;
916)   4547 E5          		      PUSH HL	;
917)   4548 D5          		      PUSH DE	;
918)   4549 E5          		      PUSH HL	;
919)   454A D5          		      PUSH DE	;
920)   454B CD 4A 43    		      CALL LCD_SETXY	;
921)   454E 21 08 00    		      LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
922)   4551 39          		      ADD HL,SP     ;	;
923)   4552 F9          		      LD SP,HL      	;
924)   4553 2A 01 63    		      LD HL,(FCOLOR)    	;
925)   4556 CD 90 43    		      CALL LCD_SETPIXEL	;
926)   4559 DD E1       		      POP IX	;
927)   455B D1          		      POP DE	;
928)   455C DD 66 01    		      LD H,(IX+1)   ;Y2	;Y2
929)   455F DD 6E 00    		      LD L,(IX)     ;Y2 	;Y2
930)   4562 ED 52       		      SBC HL,DE     ; ROW=Y2	; ROW=Y2
931)   4564 CA 4D 46    		      JP Z,DLEXIT	;
932)   4567 FD 46 01    		      LD B,(IY+1)   ;YSTEP HI	;YSTEP HI
933)   456A FD 4E 00    		      LD C,(IY)     ;YSTEP LO	;YSTEP LO
934)   456D EB          		      EX DE,HL	;
935)   456E 09          		      ADD HL,BC     ;row += ystep;	;row += ystep;
936)   456F DD 74 05    		      LD (IX+5),H   ;SAVE ROW	;SAVE ROW
937)   4572 DD 75 04    		      LD (IX+4),L   ;   	;
939)   4575 FD 56 09    		      LD D,(IY+9)   ; T	; T
940)   4578 FD 5E 08    		      LD E,(IY+8)   ; T      	; T
941)   457B FD 66 07    		      LD H,(IY+7)   ;DX	;DX
942)   457E FD 6E 06    		      LD L,(IY+6)   ;DX	;DX
943)   4581 19          		      ADD HL,DE	;
944)   4582 FD 74 09    		      LD (IY+9),H   ;t += dx;	;t += dx;
945)   4585 FD 75 08    		      LD (IY+8),L	;
946)   4588 EB          		      EX DE,HL	;
947)   4589 21 00 00    		      LD HL,0	;
948)   458C ED 52       		      SBC HL,DE	;
949)   458E 30 A8       		      JR NC,DLAGN1      	;
950)   4590 FD 46 05    		      LD B,(IY+5)   ;XSTEP HI	;XSTEP HI
951)   4593 FD 4E 04    		      LD C,(IY+4)   ;XSTEP LO	;XSTEP LO
952)   4596 DD 66 07    		      LD H,(IX+7)   ;COL HI	;COL HI
953)   4599 DD 6E 06    		      LD L,(IX+6)   ;COL LO	;COL LO
954)   459C 09          		      ADD HL,BC     ;col += xstep;	;col += xstep;
955)   459D DD 74 07    		      LD (IX+7),H   ;SAVE COL	;SAVE COL
956)   45A0 DD 75 06    		      LD (IX+6),L   ;         	;
958)   45A3 FD 66 09    		      LD H,(IY+9)   ; T	; T
959)   45A6 FD 6E 08    		      LD L,(IY+8)   ; T      	; T
960)   45A9 FD 46 03    		      LD B,(IY+3)   ;DY	;DY
961)   45AC FD 4E 02    		      LD C,(IY+2)   ;DY	;DY
962)   45AF ED 42       		      SBC HL,BC	;
963)   45B1 FD 74 09    		      LD (IY+9),H   ;t -= dY;	;t -= dY;
964)   45B4 FD 75 08    		      LD (IY+8),L								;
965)   45B7 C3 38 45    		      JP DLAGN1	;
967)   45BA 19          		      ADD HL,DE      ;HL=DY DE=DX	;HL=DY DE=DX
968)   45BB 42          		      LD B,D	;
969)   45BC 4B          		      LD C,E	;
970)   45BD CB 38       		      SRL B	;
971)   45BF CB 19       		      RR C           ;(dX >> 1)	;(dX >> 1)
972)   45C1 21 00 00    		      LD HL,0	;
973)   45C4 ED 42       		      SBC HL,BC      ;t = - (dy >> 1);	;t = - (dy >> 1);
974)   45C6 FD 74 09    		      LD (IY+9),H    ;SAVE T	;SAVE T
975)   45C9 FD 75 08    		      LD (IY+8),L    ;SAVE T	;SAVE T
977)   45CC DD 56 05    		      LD D,(IX+5)   ;ROW	;ROW
978)   45CF DD 5E 04    		      LD E,(IX+4)   ;ROW=Y1	;ROW=Y1
979)   45D2 DD 66 07    		      LD H,(IX+7)   ;COL	;COL
980)   45D5 DD 6E 06    		      LD L,(IX+6)   ;COL=X1	;COL=X1
981)   45D8 E5          		      PUSH HL       ;SAVE COL	;SAVE COL
982)   45D9 DD E5       		      PUSH IX	;
983)   45DB E5          		      PUSH HL	;
984)   45DC D5          		      PUSH DE	;
985)   45DD E5          		      PUSH HL	;
986)   45DE D5          		      PUSH DE	;
987)   45DF CD 4A 43    		      CALL LCD_SETXY	;
988)   45E2 21 08 00    		      LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
989)   45E5 39          		      ADD HL,SP     ;	;
990)   45E6 F9          		      LD SP,HL      	;
991)   45E7 2A 01 63    		      LD HL,(FCOLOR)    	;
992)   45EA CD 90 43    		      CALL LCD_SETPIXEL	;
993)   45ED DD E1       		      POP IX	;
994)   45EF D1          		      POP DE        ;RETRIEVE COL	;RETRIEVE COL
995)   45F0 DD 66 03    		      LD H,(IX+3)   ;X2	;X2
996)   45F3 DD 6E 02    		      LD L,(IX+2)   ;X2 	;X2
997)   45F6 ED 52       		      SBC HL,DE     ; COL=X2?	; COL=X2?
998)   45F8 28 53       		      JR Z,DLEXIT	;
999)   45FA EB          		      EX DE,HL      ;HL=COL	;HL=COL
1000)   45FB FD 46 05    		      LD B,(IY+5)   ;XSTEP HI	;XSTEP HI
1001)   45FE FD 4E 04    		      LD C,(IY+4)   ;XSTEP LO	;XSTEP LO
1002)   4601 09          		      ADD HL,BC     ;col += xstep;	;col += xstep;
1003)   4602 DD 74 07    		      LD (IX+7),H   ;SAVE COL	;SAVE COL
1004)   4605 DD 75 06    		      LD (IX+6),L   ;   	;
1005)   4608 FD 56 09    		      LD D,(IY+9)   ; T	; T
1006)   460B FD 5E 08    		      LD E,(IY+8)   ; T      	; T
1007)   460E FD 66 03    		      LD H,(IY+3)   ;DY	;DY
1008)   4611 FD 6E 02    		      LD L,(IY+2)   ;DY	;DY
1009)   4614 19          		      ADD HL,DE	;
1010)   4615 FD 74 09    		      LD (IY+9),H   ;t += dY;	;t += dY;
1011)   4618 FD 75 08    		      LD (IY+8),L	;
1012)   461B EB          		      EX DE,HL      ;T=DE	;T=DE
1013)   461C 21 00 00    		      LD HL,0	;
1014)   461F ED 52       		      SBC HL,DE	;
1015)   4621 30 A9       		      JR NC,DLAGN2      	;
1016)   4623 FD 46 01    		      LD B,(IY+1)   ;YSTEP HI	;YSTEP HI
1017)   4626 FD 4E 00    		      LD C,(IY)     ;YSTEP LO	;YSTEP LO
1018)   4629 DD 66 05    		      LD H,(IX+5)   ;ROW HI	;ROW HI
1019)   462C DD 6E 04    		      LD L,(IX+4)   ;ROW LO	;ROW LO
1020)   462F 09          		      ADD HL,BC     ;ROW += Ystep;	;ROW += Ystep;
1021)   4630 DD 74 05    		      LD (IX+5),H   ;SAVE COL	;SAVE COL
1022)   4633 DD 75 04    		      LD (IX+4),L   ;         	;
1024)   4636 FD 66 09    		      LD H,(IY+9)   ; T	; T
1025)   4639 FD 6E 08    		      LD L,(IY+8)   ; T      	; T
1026)   463C FD 46 07    		      LD B,(IY+7)   ;DX	;DX
1027)   463F FD 4E 06    		      LD C,(IY+6)   ;DX	;DX
1028)   4642 ED 42       		      SBC HL,BC	;
1029)   4644 FD 74 09    		      LD (IY+9),H   ;t -= dX;	;t -= dX;
1030)   4647 FD 75 08    		      LD (IY+8),L								;
1031)   464A C3 CC 45    		      JP DLAGN2	;
1034)   464D 21 0A 00    		      LD HL,10      ;REMOVE 10 IY PARAMS FROM STACK	;REMOVE 10 IY PARAMS FROM STACK
1035)   4650 39          		      ADD HL,SP     ;	;
1036)   4651 F9          		      LD SP,HL           	;
1037)   4652 C9          		      RET          	;
1044)   4653 FE 08       		      CP 0X08   ;BACKSPACE	;BACKSPACE
1045)   4655 CA 65 46    		      JP Z,PRCH_DOBCKSPC	;
1046)   4658 FE 0A       		      CP 0X0A   ;LINE FEED JUST IGNORE IT	;LINE FEED JUST IGNORE IT
1047)   465A C8          		      RET Z	;
1048)   465B FE 0D       		      CP 0X0D   ;CHECK FOR ENTER	;CHECK FOR ENTER
1049)   465D 20 33       		      JR NZ,PRCH_DOPRN	;
1050)   465F 21 05 63    		      LD HL,CURSORX	;
1051)   4662 C3 05 47    		      JP PRCH_NEWLN 	;
1053)   4665 21 05 63    		      LD HL,CURSORX	;
1054)   4668 7E          		      LD A,(HL)	;
1055)   4669 FE 01       		      CP 1      ;COMPARE WITH COLUMN 1 CAUSE OF THE PROMPT ON COLUMN 0	;COMPARE WITH COLUMN 1 CAUSE OF THE PROMPT ON COLUMN 0
1056)   466B 28 0A       		      JR Z,PRCH_DOBCKSPC2     ;IF 0 WE ARE ON THE 1ST COLUMN SO NOTHING TO DO JUST DELETE THE 8=BS FROM BUFFER	;IF 0 WE ARE ON THE 1ST COLUMN SO NOTHING TO DO JUST DELETE THE 8=BS FROM BUFFER
1057)   466D 35          		      DEC (HL)  ;GO 1 POSITION BACK	;GO 1 POSITION BACK
1058)   466E E5          		      PUSH HL	;
1059)   466F 3E 20       		      LD A,32   ;PRINT SPACE	;PRINT SPACE
1060)   4671 CD 92 46    		      CALL PRCH_DOPRN ;THIS FORWARDS THE CURSOR SO WE SHOULD GO BACK AGAIN	;THIS FORWARDS THE CURSOR SO WE SHOULD GO BACK AGAIN
1061)   4674 E1          		      POP HL	;
1062)   4675 35          		      DEC (HL)  ;GO 1 POSITION BACK	;GO 1 POSITION BACK
1063)   4676 B7          		      OR A      	;
1067)   4677 DD 21 02 00 		      LD IX,2	;
1068)   467B DD 39       		      ADD IX,SP	;
1069)   467D DD 66 01    		      LD H,(IX+1);POSITION IN ACCS FOR THE NEW CHARACTER      	;POSITION IN ACCS FOR THE NEW CHARACTER
1070)   4680 DD 6E 00    		      LD L,(IX) ;POSITION IN ACCS FOR THE NEW CHARACTER  	;POSITION IN ACCS FOR THE NEW CHARACTER
1071)   4683 3E 00       		      LD A,0    ;NOT XOR WE DONT WANT TO MESS WITH ZERO FLAG	;NOT XOR WE DONT WANT TO MESS WITH ZERO FLAG
1072)   4685 28 02       		      JR Z,PRCH_SKIP1  ;WE ARE ON COLUMN 1	;WE ARE ON COLUMN 1
1073)   4687 2B          		      DEC HL     ;PREVIOUS POSITION DELETE BACKSPACE	;PREVIOUS POSITION DELETE BACKSPACE
1074)   4688 77          		      LD (HL),A  ;PUT 0 ON LAST POSITION	;PUT 0 ON LAST POSITION
1076)   4689 2B          		      DEC HL     ;PREVIOUS POSITION DELETE PREVIOUS CHAR	;PREVIOUS POSITION DELETE PREVIOUS CHAR
1077)   468A 77          		      LD (HL),A  ;PUT 0 ON LAST POSITION      	;PUT 0 ON LAST POSITION
1078)   468B DD 74 01    		      LD (IX+1),H ;PUT POSITION BACK ON STACK IT WILL POPED	;PUT POSITION BACK ON STACK IT WILL POPED
1079)   468E DD 75 00    		      LD (IX),L	;
1080)   4691 C9          		      RET	;
1083)   4692 F5          		      PUSH AF  ;SAVE CHAR TO STACK	;SAVE CHAR TO STACK
1084)   4693 32 07 63    		      LD (LASTCHAR),A ;SAVE LAST PRINTED CHAR	;SAVE LAST PRINTED CHAR
1085)   4696 0E 01       		      LD C,1	;
1086)   4698 3A 05 63    		      LD A,(CURSORX)	;
1088)   469B 06 08       		      LD B,FONT_WIDTH	;
1089)   469D 16 00       		      LD D,0	;
1090)   469F 5F          		      LD E,A	;
1091)   46A0 21 00 00    		      LD HL,0	;
1093)   46A3 ED 5A       		      ADC HL,DE	;
1094)   46A5 10 FC       		      DJNZ PRCH_AGN1	;
1095)   46A7 E5          		      PUSH HL       ;1ST PARAM X1 & 3RD PARAM	;1ST PARAM X1 & 3RD PARAM
1096)   46A8 3C          		      INC A	;
1097)   46A9 0D          		      DEC C	;
1098)   46AA 28 EF       		      JR Z,PRCH_AGN1A	;
1099)   46AC 3A 06 63    		      LD A,(CURSORY)	;
1100)   46AF 0E 01       		      LD C,1	;
1102)   46B1 06 0A       		      LD B,FONT_HEIGHT 	;
1103)   46B3 16 00       		      LD D,0	;
1104)   46B5 5F          		      LD E,A	;
1105)   46B6 21 00 00    		      LD HL,0	;
1107)   46B9 ED 5A       		      ADC HL,DE	;
1108)   46BB 10 FC       		      DJNZ PRCH_AGN2      	;
1109)   46BD 0D          		      DEC C	;
1110)   46BE 20 07       		      JR NZ,PRCH_AGN2B	;
1111)   46C0 D1          		      POP DE        ;3RD PARAM X2	;3RD PARAM X2
1112)   46C1 E5          		      PUSH HL       ;2ND PARAM Y1	;2ND PARAM Y1
1113)   46C2 1B          		      DEC DE        ;3RD PARAM - 1	;3RD PARAM - 1
1114)   46C3 D5          		      PUSH DE       ;3RD PARAM X2	;3RD PARAM X2
1115)   46C4 3C          		      INC A	;
1116)   46C5 18 EA       		      JR PRCH_AGN2A	;
1118)   46C7 2B          		      DEC HL        ;4TH PARAM -1  	;4TH PARAM -1
1119)   46C8 E5          		      PUSH HL				;4TH PARAM Y2	;4TH PARAM Y2
1120)   46C9 CD 4A 43    		      CALL LCD_SETXY	;
1121)   46CC 21 08 00    		      LD HL,8	;
1122)   46CF 39          		      ADD HL,SP	;
1123)   46D0 F9          		      LD SP,HL      ;SKIP 4 PARAMS 8 BYTES	;SKIP 4 PARAMS 8 BYTES
1124)   46D1 F1          		      POP AF        ;CHAR TO PRINT FROM STACK	;CHAR TO PRINT FROM STACK
1125)   46D2 21 00 48    		      LD HL,FONT_ADDR	;
1126)   46D5 16 00       		      LD D,0	;
1127)   46D7 5F          		      LD E,A	;
1128)   46D8 ED 5A       		      ADC HL,DE     ;THIS IS THE CHAR ADDRESS	;THIS IS THE CHAR ADDRESS
1129)   46DA E5          		      PUSH HL	;
1130)   46DB D1          		      POP DE        ; CHAR ADDRESS ON DE	; CHAR ADDRESS ON DE
1131)   46DC 0E 0A       		      LD C,FONT_HEIGHT   ; TOTAL FONT LINES	; TOTAL FONT LINES
1133)   46DE 1A          		      LD A,(DE)           ;FONT 8BIT PATTERN FOR A LINE	;FONT 8BIT PATTERN FOR A LINE
1134)   46DF 06 07       		      LD B,FONT_WIDTH-1	;
1136)   46E1 CB 27       		      SLA A               ;CHECK BIT FOR 1=FCOLOR OR 0=BCOLOR	;CHECK BIT FOR 1=FCOLOR OR 0=BCOLOR
1137)   46E3 38 05       		      JR C,FORECOLOR	;
1138)   46E5 2A 03 63    		      LD HL,(BCOLOR)	;
1139)   46E8 18 03       		      JR PRCH_CONT	;
1141)   46EA 2A 01 63    		      LD HL,(FCOLOR)      	;
1143)   46ED F5          		      PUSH AF	;
1144)   46EE D5          		      PUSH DE	;
1145)   46EF CD 90 43    		      CALL LCD_SETPIXEL	;
1146)   46F2 D1          		      POP DE	;
1147)   46F3 F1          		      POP AF      	;
1148)   46F4 10 EB       		      DJNZ PRCH_AGN4	;
1149)   46F6 14          		      INC D             ;ADD 256 FOR NEXT CHAR PATTERN	;ADD 256 FOR NEXT CHAR PATTERN
1150)   46F7 0D          		      DEC C	;
1151)   46F8 20 E4       		      JR NZ,PRCH_AGN3	;
1153)   46FA 21 05 63    		      LD HL,CURSORX	;
1154)   46FD 7E          		      LD A,(HL)	;
1155)   46FE 3C          		      INC A	;
1156)   46FF FE 50       		      CP 80	;
1157)   4701 28 02       		      JR Z,PRCH_NEWLN  ;NEW LINE	;NEW LINE
1158)   4703 77          		      LD (HL),A	;
1159)   4704 C9          		      RET	;
1162)   4705 AF          		      XOR A  	;
1163)   4706 77          		      LD (HL),A   	;
1164)   4707 23          		      INC HL	;
1165)   4708 7E          		      LD A,(HL)	;
1166)   4709 3C          		      INC A       	;
1167)   470A 77          		      LD (HL),A	;
1171)   470B C9          		      RET	;
1175)   470C 3E 41       		    LD A,65	;
1176)   470E CD 53 46    		    CALL LCD_PRINTCHAR	;
1177)   4711 21 05 63    		    LD HL,CURSORX	;
1178)   4714 34          		    INC (HL)	;
1179)   4715 3E 42       		    LD A,66	;
1180)   4717 CD 53 46    		    CALL LCD_PRINTCHAR	;
1182)   471A C9          		    RET	;
1184)   471B 21 0A 00    		    LD HL,10	;
1185)   471E 01 D2 00    		    LD BC,210	;
1186)   4721 C5          		    PUSH BC	;
1187)   4722 E5          		    PUSH HL	;
1188)   4723 E5          		    PUSH HL	;
1189)   4724 C5          		    PUSH BC	;
1190)   4725 CD 67 44    		    CALL LCD_DRAWLINE 	;
1191)   4728 21 08 00    		    LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
1192)   472B 39          		    ADD HL,SP	;
1193)   472C F9          		    LD SP,HL    	;
1199)   472D 21 0A 00    		    LD HL,10	;
1200)   4730 01 D2 00    		    LD BC,210	;
1201)   4733 E5          		    PUSH HL	;
1202)   4734 E5          		    PUSH HL	;
1203)   4735 C5          		    PUSH BC	;
1204)   4736 C5          		    PUSH BC	;
1205)   4737 CD 67 44    		    CALL LCD_DRAWLINE 	;
1206)   473A 21 08 00    		    LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
1207)   473D 39          		    ADD HL,SP	;
1208)   473E F9          		    LD SP,HL    	;
1212)   473F 21 0A 00    		    LD HL,10	;
1213)   4742 01 D2 00    		    LD BC,210	;
1214)   4745 E5          		    PUSH HL	;
1215)   4746 E5          		    PUSH HL	;
1216)   4747 C5          		    PUSH BC	;
1217)   4748 E5          		    PUSH HL	;
1218)   4749 CD 67 44    		    CALL LCD_DRAWLINE 	;
1219)   474C 21 08 00    		    LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
1220)   474F 39          		    ADD HL,SP	;
1221)   4750 F9          		    LD SP,HL	;
1222)   4751 21 0A 00    		    LD HL,10	;
1223)   4754 01 D2 00    		    LD BC,210	;
1224)   4757 E5          		    PUSH HL	;
1225)   4758 E5          		    PUSH HL	;
1226)   4759 E5          		    PUSH HL	;
1227)   475A C5          		    PUSH BC	;
1228)   475B CD 67 44    		    CALL LCD_DRAWLINE 	;
1229)   475E 21 08 00    		    LD HL,8       ;REMOVE PARAMS FROM STACK	;REMOVE PARAMS FROM STACK
1230)   4761 39          		    ADD HL,SP	;
1231)   4762 F9          		    LD SP,HL    	;
1232)   4763 C9          		    RET	;
1235)   4764 00 00 00 00 		    ALIGN 256	;
1235)   4768 00 00 00 00 		    ALIGN 256	;
1235)   476C 00 00 00 00 		    ALIGN 256	;
1235)   4770 00 00 00 00 		    ALIGN 256	;
1235)   4774 00 00 00 00 		    ALIGN 256	;
1235)   4778 00 00 00 00 		    ALIGN 256	;
1235)   477C 00 00 00 00 		    ALIGN 256	;
1235)   4780 00 00 00 00 		    ALIGN 256	;
1235)   4784 00 00 00 00 		    ALIGN 256	;
1235)   4788 00 00 00 00 		    ALIGN 256	;
1235)   478C 00 00 00 00 		    ALIGN 256	;
1235)   4790 00 00 00 00 		    ALIGN 256	;
1235)   4794 00 00 00 00 		    ALIGN 256	;
1235)   4798 00 00 00 00 		    ALIGN 256	;
1235)   479C 00 00 00 00 		    ALIGN 256	;
1235)   47A0 00 00 00 00 		    ALIGN 256	;
1235)   47A4 00 00 00 00 		    ALIGN 256	;
1235)   47A8 00 00 00 00 		    ALIGN 256	;
1235)   47AC 00 00 00 00 		    ALIGN 256	;
1235)   47B0 00 00 00 00 		    ALIGN 256	;
1235)   47B4 00 00 00 00 		    ALIGN 256	;
1235)   47B8 00 00 00 00 		    ALIGN 256	;
1235)   47BC 00 00 00 00 		    ALIGN 256	;
1235)   47C0 00 00 00 00 		    ALIGN 256	;
1235)   47C4 00 00 00 00 		    ALIGN 256	;
1235)   47C8 00 00 00 00 		    ALIGN 256	;
1235)   47CC 00 00 00 00 		    ALIGN 256	;
1235)   47D0 00 00 00 00 		    ALIGN 256	;
1235)   47D4 00 00 00 00 		    ALIGN 256	;
1235)   47D8 00 00 00 00 		    ALIGN 256	;
1235)   47DC 00 00 00 00 		    ALIGN 256	;
1235)   47E0 00 00 00 00 		    ALIGN 256	;
1235)   47E4 00 00 00 00 		    ALIGN 256	;
1235)   47E8 00 00 00 00 		    ALIGN 256	;
1235)   47EC 00 00 00 00 		    ALIGN 256	;
1235)   47F0 00 00 00 00 		    ALIGN 256	;
1235)   47F4 00 00 00 00 		    ALIGN 256	;
1235)   47F8 00 00 00 00 		    ALIGN 256	;
1235)   47FC 00 00 00 00 		    ALIGN 256	;
1240)   6300 00          		    FLAGS		 DEFS	1		; Flags: B7=ESC PRESSED, B6=ESC DISABLED	; Flags: B7=ESC PRESSED, B6=ESC DISABLED
1241)   6301 55 55       		    FCOLOR   DEFW 0X5555 ;FOREGROUND COLOR	;FOREGROUND COLOR
1242)   6303 AA AA       		    BCOLOR   DEFW 0XAAAA ;BACKGROUND COLOR	;BACKGROUND COLOR
1243)   6305 00          		    CURSORX  DEFB 0    ;0-79	;0-79
1244)   6306 00          		    CURSORY  DEFB 0    ;0-47	;0-47
1245)   6307 00          		    LASTCHAR DEFB 0; 	;
